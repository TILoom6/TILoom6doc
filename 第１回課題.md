# 第１回設計の課題

# 背景

あなたはとあるサーバーの管理者だ。
最近はセキュリティが課題である。
この課題に対処するために、サーバーにログインしたユーザーがどんな操作をしたかログに出すサードパーティ製のツール「OpLogger」を導入した。
ところが「OpLogger」が出力したログは、そのままだと見づらい。よって、あなたは同僚のAさんにログをGUIでいい感じに見るためのツール「OpViewer」を開発してもらった。
さぁあとはログを「OpViewer」が解釈できる形に変換するブリッジライブラリを書くだけだ。

# 目的

「OpLogger」が出力したログを「OpViewer」が解釈できる形にブリッジライブラリを書く。
それなりに長期的（予想：数年）に使用するつもりなので、ちゃんと設計する必要がある。
今回は設計の完遂を目指す。

「OpViewer」でみたい内容は以下である。

- ユーザー名
- 操作した時点のタイムスタンプ
- 操作分類（ログイン/ログアウト/作成/変更/削除）
- 操作内容（打ったコマンド。引数つき）
- 操作結果（成否）

コレを１レコードとし、レコード集合を表形式で表示する。
ただし、表示はユーザー単位、日付の昇順でする。

## ただし悲しい現実が

しかしなんと「OpViewer」は手抜きで作ったクソツールであるため、ユーザー単位のグルーピング、ソートの機能はない。
そして同僚Aは失踪し、ソースもない。
よって、あなたは泣く泣くグルーピング、ソートはブリッジライブラリ側で実現する必要に迫られている。

# 要件
## ブリッジライブラリでやりたいこと

大まかに分類すると以下

- 「OpLogger」からログを読み込む
- ログをユーザ別にグルーピングする
- 日付順にソートする
- 「OpViewer」が解釈できる形に変換する
## ログを見たいタイミング

現状１日の終わりに１回だけ。

# 補足

OpLoggerの仕様

- バックグラウンドプロセスとして常駐している
- ユーザーがサーバーに入って操作するたびにリアルタイムでログを出力する
- ログは以下を１レコードとして出力する
  - ユーザー名
  - 操作したタイムスタンプ（タイムゾーンはローカライズ済）
  - 操作分類ID（ログイン/ログアウト/作成/変更/削除）
    - 半角の数字で表現される
    - 1：ログイン
    - 2：ログアウト
    - 3：作成
    - 4：変更
    - 5：削除
  - 操作内容（打ったコマンド。引数つき）
  - 操作結果（成否）
    - 0：成功
    - 0以外：失敗
- ログのフォーマットはTSV
- ログ出力先のディレクトリは/hoge固定
## OpViewerの仕様
- JSONフォーマットのファイルを読み込んで表形式に整形して表示する
- JSONフォーマット
    {
      title: [  // カラム名のリスト
        "title1", "title2", ... // title1, 2の部分は任意のカラム名. 記述できる個数も任意
      ],
      dataList: [{  // 表示したいデータのリスト.せん等から順番に表示
        "title1": <データ>,  // プロパティ名はtitle. 値の型は Number or String
        "title2": <データ>,
        ...
      }, {
        "title1": <データ>,
        "title2": <データ>,
        ...
      }]
    }



